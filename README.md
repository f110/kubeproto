kubeproto
---

kubeproto is a plugin of Protocol Buffers to defined k8s API.

The code generated by these plugins is incompatible with the code generated by code-generator.

**WORK IN PROGRESS**

# Synopsis

github.proto

```protobuf
syntax = "proto3";
package example.apis.githubv1alpha1;
option go_package = "go.f110.dev/kubeproto/example/pkg/apis/githubv1alpha1";
option (dev.f110.kubeproto.k8s) = {
  domain: "f110.dev",
  sub_group: "grafana",
  version: "v1alpha1",
};

import "kube.proto";

message Grafana {
  GrafanaSpec   spec   = 1;
  GrafanaStatus status = 2;
        
  option (dev.f110.kubeproto.kind) = {};
}
```

BUILD at pkg/apis/GROUP_AND_VERSION for generating deepcopy and register

```
load("@rules_proto//proto:defs.bzl", "proto_library")
load("//bazel:def.bzl", "kubeproto_go_api")

proto_library(
    name = "github_proto",
    srcs = ["github.proto"],
    deps = [
        "//:kubeproto",
    ],
    visibility = ["//visibility:public"],
)

kubeproto_go_api(
    name = "github_proto_kubeproto",
    srcs = [":github_proto"],
    importpath = "go.f110.dev/kubeproto/example/pkg/apis/githubv1alpha1",
)
```

BUILD file for generating CustomResourceDefinition

```
load("//bazel/crd:def.bzl", "crd_proto_manifest")

crd_proto_manifest(
    name = "github",
    srcs = [
        "//example/pkg/apis/githubv1alpha1:github_proto",
        "//example/pkg/apis/githubv1alpha2:github_proto",
    ],
    visibility = ["//visibility:public"],
)
```

# Author

Fumihiro Ito